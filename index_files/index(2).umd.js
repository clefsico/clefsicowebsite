(function(g,f){typeof exports=="object"&&typeof module<"u"?module.exports=f():typeof define=="function"&&define.amd?define(f):(g=typeof globalThis<"u"?globalThis:g||self,g.StudioSdkPlugins_listPagesComponent=f())})(this,function(){"use strict";const g="app.grapesjs.com",f="app-stage.grapesjs.com",E=[g,f,"localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],N="license:check:start",x="license:check:end",S=()=>typeof window<"u",R=({isDev:e,isStage:n})=>`${e?"":`https://${n?f:g}`}/api`,U=()=>{const e=S()&&window.location.hostname;return!!e&&(E.includes(e)||E.some(n=>e.endsWith(n)))};async function D({path:e,baseApiUrl:n,method:i="GET",headers:t={},params:o,body:a}){const c=`${n||R({isDev:!1,isStage:!1})}${e}`,r={method:i,headers:{"Content-Type":"application/json",...t}};a&&(r.body=JSON.stringify(a));const u=o?new URLSearchParams(o).toString():"",s=u?`?${u}`:"",l=await fetch(`${c}${s}`,r);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return l.json()}var h=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(h||{});const k={[h.free]:0,[h.startup]:10,[h.business]:20,[h.enterprise]:30};function W(e){const n=e;return n.init=i=>t=>e(t,i),n}const O=e=>W(e);async function B({editor:e,plan:n,pluginName:i,licenseKey:t,cleanup:o}){let a="",p=!1;const c=U(),r=s=>{console.warn("Cleanup plugin:",i,"Reason:",s),o()},u=(s={})=>{var T;const{error:l,sdkLicense:w}=s,P=(T=s.plan)==null?void 0:T.category;if(!(w||s.license)||l)r(l||"Invalid license");else if(P){const C=k[n],I=k[P];C>I&&r({pluginRequiredPlan:n,licensePlan:P})}};e.on(N,s=>{a=s==null?void 0:s.baseApiUrl,p=!0}),e.on(x,s=>{u(s)}),setTimeout(async()=>{if(!p){if(c)return;if(t){const s=await K({licenseKey:t,pluginName:i,baseApiUrl:a});s&&u(s)}else r("The `licenseKey` option not provided")}},2e3)}async function K(e){const{licenseKey:n,pluginName:i,baseApiUrl:t}=e;try{return(await D({baseApiUrl:t,path:`/sdk/${n||"na"}`,method:"POST",params:{d:window.location.hostname,pn:i}})).result||{}}catch(o){return console.error("Error during SDK license check:",o),!1}}const v="gjs-plg-",j="listPagesComponent",F=h.startup;function G(e,n,i){let t,o,a,p,c;const r=n;function u(){const l=Date.now()-p;l<r&&l>=0?t=setTimeout(u,r-l):(t=null,c=e.apply(a,o),a=o=null)}const s=function(){return a=this,o=arguments,p=Date.now(),t||(t=setTimeout(u,r)),c};return s.clear=function(){t&&(clearTimeout(t),t=null)},s.flush=function(){t&&(c=e.apply(a,o),a=o=null,clearTimeout(t),t=null)},s}const M="page://",m="list-pages",y="list-pages-item",d="list-pages-link",q=e=>e.components().reduce((n,i)=>{var p;const t=i.findFirstType(d),o=(p=t==null?void 0:t.attributes.attributes)==null?void 0:p.href,a=o!=null&&o.startsWith(M)?o.replace(M,""):"";if(a&&t){const c=n[a];c?c.push(t):n[a]=[t]}return n},{}),b="data-type-role",X="page_root",Y=e=>n=>n.is(e),Z=e=>(n,i)=>i.is(e),H=e=>n=>{var i;return((i=n.getAttribute)==null?void 0:i.call(n,b))===e};return O(function(e,n={}){const{Blocks:i,Components:t,Pages:o}=e,{licenseKey:a,block:p={}}=n,c="List Pages",r="List Pages Item",u="Link",s=`${v}${m}`,l=`${v}${d}`,w='<svg viewBox="0 0 24 24"><path d="M11 15H17V17H11V15M9 7H7V9H9V7M11 13H17V11H11V13M11 9H17V7H11V9M9 11H7V13H9V11M21 5V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3H19C20.1 3 21 3.9 21 5M19 5H5V19H19V5M9 15H7V17H9V15Z"/></svg>',P='<svg viewBox="0 0 24 24"><path d="M7,5H21V7H7V5M7,13V11H21V13H7M4,4.5A1.5,1.5 0 0,1 5.5,6A1.5,1.5 0 0,1 4,7.5A1.5,1.5 0 0,1 2.5,6A1.5,1.5 0 0,1 4,4.5M4,10.5A1.5,1.5 0 0,1 5.5,12A1.5,1.5 0 0,1 4,13.5A1.5,1.5 0 0,1 2.5,12A1.5,1.5 0 0,1 4,10.5M7,19V17H21V19H7M4,16.5A1.5,1.5 0 0,1 5.5,18A1.5,1.5 0 0,1 4,19.5A1.5,1.5 0 0,1 2.5,18A1.5,1.5 0 0,1 4,16.5Z" /></svg>';t.addType(m,{block:p&&{label:c,media:w,category:"Extra",select:!0,...n.block},isComponent:H(m),model:{defaults:{tagName:"ul",name:c,[X]:"",classes:s,attributes:{[b]:m,role:"navigation"},droppable:Y(y),styles:`
          .${s} {
            list-style: none;
            margin: 0;
            padding: 0;
          }
        `},init(){this.syncPageItems=G(this.syncPageItems.bind(this),0),this.listenTo(this.em,o.events.all,this.syncPageItems),this.syncPageItems()},syncPageItems(){if(e.Components.getSymbolInfo(this).isInstance)return;const L=this.em.Pages.getAll(),T=this.components(),C=q(this);L.forEach((I,J)=>{const _=I.id,V=I.getName(),A=C[_];A?A==null||A.forEach($=>{$.getInnerHTML()!==V&&$.components(V)}):T.add({type:y,components:[{type:d,attributes:{href:`page://${_}`},components:{type:"textnode",content:V}}]},{at:J})})}}}),t.addType(y,{isComponent:H(y),model:{defaults:{name:r,tagName:"li",icon:P,attributes:{[b]:y},components:{type:d},draggable:Z(m)}}}),t.addType(d,{extend:"link",isComponent:H(d),model:{defaults:{removable:!1,copyable:!1,delegate:{move:L=>L.closestType(y)},name:u,classes:l,attributes:{[b]:d},components:{type:"textnode",content:"Item"},styles:`
          .${l} {
            text-decoration: none;
          }
        `}}}),B({editor:e,licenseKey:a,plan:F,pluginName:j,cleanup:()=>{i.remove(m),t.removeType(m)}})})});
